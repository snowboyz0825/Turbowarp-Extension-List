class SPtest2{getInfo(){return{id:"SPtest",name:"Obj Filt",blocks:[{opcode:"filterJson",text:"filter JSON [OBJ] with string [STR]",blockType:Scratch.BlockType.REPORTER,arguments:{OBJ:{type:Scratch.ArgumentType.STRING},STR:{type:Scratch.ArgumentType.STRING}}},{opcode:"orderJson",text:"order JSON [OBJ] with string [STR]",blockType:Scratch.BlockType.REPORTER,arguments:{OBJ:{type:Scratch.ArgumentType.STRING},STR:{type:Scratch.ArgumentType.STRING}}},{opcode:"typeString",text:"[STRING1] || [STRING2]",blockType:Scratch.BlockType.REPORTER,arguments:{STRING1:{type:Scratch.ArgumentType.STRING},STRING2:{type:Scratch.ArgumentType.STRING}}},{opcode:"exportME",text:"my skin data",blockType:Scratch.BlockType.REPORTER},{opcode:"prompt",text:"prompt [STR]",blockType:Scratch.BlockType.REPORTER,arguments:{STR:{type:Scratch.ArgumentType.STRING}}},{opcode:"goToLink",blockType:Scratch.BlockType.COMMAND,text:"open link [INPUT]",arguments:{INPUT:{type:Scratch.ArgumentType.STRING}}},{opcode:"redirectToLink",blockType:Scratch.BlockType.COMMAND,text:"redirect to [INPUT]",arguments:{INPUT:{type:Scratch.ArgumentType.STRING}}},{opcode:"setQual",blockType:Scratch.BlockType.COMMAND,text:"set qual to [VAL]",arguments:{VAL:{type:Scratch.ArgumentType.NUMBER}}},]}}filterJson(e){return JSON.stringify(function t(r){if("object"==typeof r&&null!==r){let n={};for(let[o,a]of Object.entries(r))if(String(o).toLowerCase().includes(e.STR.toLowerCase())||"string"==typeof a&&a.toLowerCase().includes(e.STR.toLowerCase()))n[o]=a;else if("object"==typeof a){let i=t(a);Object.keys(i).length>0&&(n[o]={...a,...i})}return n}return Array.isArray(r)?r.map(e=>t(e)).filter(e=>"object"==typeof e&&Object.keys(e).length>0):r}(JSON.parse(e.OBJ)||{}),null,2)}orderJson(e){let{matching:t,nonMatching:r}=function t(r){let n={},o={};if("object"==typeof r&&null!==r)for(let[a,i]of Object.entries(r))if(String(a).toLowerCase().includes(e.STR.toLowerCase())||"string"==typeof i&&i.toLowerCase().includes(e.STR.toLowerCase()))n[a]=i;else if("object"==typeof i){let{matching:l,nonMatching:p}=t(i);Object.keys(l).length>0&&(n[a]={...i,...l}),Object.keys(p).length>0&&(o[a]={...i,...p})}else o[a]=i;else Array.isArray(r)?r.forEach((e,r)=>{let{matching:a,nonMatching:i}=t(e);Object.keys(a).length>0&&(n[r]={...e,...a}),Object.keys(i).length>0&&(o[r]={...e,...i})}):o.value=r;return{matching:n,nonMatching:o}}(JSON.parse(e.OBJ)||{});return JSON.stringify({...t,...r},null,2)}goToLink(e){Scratch.openWindow(e.INPUT)}redirectToLink(e){Scratch.redirect(e.INPUT)}prompt(e){return window.prompt(e.STR)}typeString(e){return e.STRING1||e.STRING2}exportME(e,t){if(-1===vm.renderer._drawList.indexOf(t.target.drawableID))return"";let r=vm.runtime.renderer.extractDrawableScreenSpace(t.target.drawableID).imageData;var n=document.createElement("canvas");return n.width=r.width,n.height=r.height,n.getContext("2d").putImageData(r,0,0),this.stretch(n.toDataURL("image/png"),1.61*r.width,1.61*r.height)}stretch(e,t,r){return new Promise(n=>{let o=new Image;o.onload=()=>{n(this.exportImg(o,this.printImg(o,t,r),t,r))},o.src=e})}printImg(e,t,r){let n=document.createElement("canvas");n.width=t||e.width,n.height=r||e.height;let o=n.getContext("2d");return o.drawImage(e,0,0,n.width,n.height),o.getImageData(0,0,n.width,n.height).data}exportImg(e,t,r,n){let o=document.createElement("canvas");return o.width=r||e.width,o.height=n||e.height,o.getContext("2d").putImageData(new ImageData(new Uint8ClampedArray(t),o.width,o.height),0,0),o.toDataURL()}setQual(e,t){let r=vm.renderer._allDrawables[t.target.drawableID];r.setHighQuality(!0),r.skin._maxTextureScale=Scratch.Cast.toNumber(e.VAL),r.skin.emitWasAltered()}}Scratch.extensions.register(new SPtest2);data:application/javascript,!function(t){"use strict";let e=t.ArgumentType,i=t.BlockType,r=t.Cast;t.extensions.register(new class t{constructor(){this.failed=!1,this.error="",this.waiting=!1,this.origin="",window.addEventListener("message",t=>{this.handleWindowMessage(t)}),this._possibleErrors={noParents:"No parent window",timedOut:"Timed out",notTrusted:"Your website is not trusted",couldntLoad:"Extension failed to load\n",noExt:"No extension URL was provided",notString:"Extension URL was not a string"}}getInfo(){return{id:"jgExtGalleryLoader",name:"Gallery Extension Loader",blocks:[{blockType:i.LABEL,text:"Editor Origin must be set before use."},{blockType:i.LABEL,text:'Editor Origin will be the "window.origin"'},{blockType:i.LABEL,text:"of the editor window."},{opcode:"setExpectingURL",blockType:i.COMMAND,text:"set editor origin to [URL]",arguments:{URL:{type:e.STRING,defaultValue:"https://studio.penguinmod.com"}}},{opcode:"loadFromURL",blockType:i.COMMAND,text:"request to load extension url [URL]",arguments:{URL:{type:e.STRING,defaultValue:"https://extensions.turbowarp.org/stretch.js"}}},"---",{opcode:"getwaiting",blockType:i.BOOLEAN,text:"waiting?"},{opcode:"getfailed",blockType:i.BOOLEAN,text:"failed?"},{opcode:"geterror",blockType:i.REPORTER,text:"error"},]}}handleWindowMessage(t){if(!t.origin.startsWith(this.origin)||!t.data||!t.data.p4)return;let e=t.data.p4;if(e.type){if(this.waiting=!1,"success"===e.type){console.log("Loading extension was a success"),this.failed=!1,this.error="";return}switch(console.log("Loading extension failed"),this.failed=!0,e.error){case"not_trusted":this.error=this._possibleErrors.notTrusted;break;case"no_loadExt":this.error=this._possibleErrors.noExt;break;case"not_string":this.error=this._possibleErrors.notString;break;case"couldnt_load":this.error=this._possibleErrors.couldntLoad+e.pmerror;break;default:this.error=e.error}}}setExpectingURL(t){this.origin=r.toString(t.URL)}loadFromURL(t){if("O%Lu4:uu]X#B}{q8PWYW"!==vm.runtime.targets[0].id||this.waiting)return;this.waiting=!1;let e=r.toString(t.URL),i=window.opener||window.parent;if(!i){this.failed=!0,this.error=this._possibleErrors.noParents;return}this.waiting=!0,setTimeout(()=>{this.waiting&&(this.waiting=!1,this.failed=!0,this.error=this._possibleErrors.timedOut)},2500),i.postMessage({loadExt:e},this.origin)}getwaiting(){return this.waiting}getfailed(){return this.failed}geterror(){return this.error}})}(Scratch);